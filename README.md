# Local Illustlation Image Files Searcher with CLIP ViT
## What's This?
- Local illustration image files search engine with CLIP ViT
  - can be used for photos. But flexible photo search is offered by Google Photos or etc :)
- Search capabilities of cloud photo album services towards illustration image files are poor for some reason
- So, I wrote simple scripts

## Method
- Search image files with matching latent representations of image files and query texts. The representations are generated with CLIP ViT (Vision Transformer) 
- [OpenClip](https://github.com/mlfoundations/open_clip) and [laion/CLIP-ViT-H-14-laion2B-s32B-b79K pretrained model](https://huggingface.co/laion/CLIP-ViT-H-14-laion2B-s32B-b79K) is used for generating the representations
  - laion2B dataset includes illust images. So it is better than other CLIP models for illust image file search :)
  - Faiss is used for creating index of latent representation vectors of image files
- ( Web UI is implemented with StreamLit )

## Usage
- $ pip install -r requirements.txt
- $ python gen-clip-vector-index.py --dir "IMAGE FILES CONTAINED DIR PATH"
  - The script searches directory structure recursively :)
  - This takes quite a while...
    - About 0.8 sec/file at middle spec desktop PC (GPU is not used)
      - AMD Ryzen 7 5700X 8-Core Processor 4.50 GHz
    - You may speed up with editing the script :)
      - For example, you can make it to use GPU for CLIP model inference 
- $ streamlit run web-ui-image-search.py
  - Search app is opend on your web browser

## Attention
- Character Code of File pathes  
  - If file path contains characters which can't be contered to Unicode or utf-8, scripts may ouput error message at processing the file
  - But, it doesn't mean that your script usage is wrong. Though these files is ignored or not displayed at Web UI :|
    - This is problem of current implentation. When you use scripts on Windows and character code of directory/file names isn't utf-8, the problem may occur

## TODO
- [x] Search on latent representation generated by CLIP model such as [this](https://huggingface.co/laion/CLIP-ViT-H-14-laion2B-s32B-b79K)
  - Not doing tagging
  - Reference: ["Image Search app with CLIP+Faiss+Streamlit - OPTiM Tech Blog"](https://tech--blog-optim-co-jp.translate.goog/entry/2022/07/04/100000?_x_tr_sl=ja&_x_tr_tl=en&_x_tr_hl=ja&_x_tr_pto=wapp)
- [ ] Incremental index updating at image files increasing
- [ ] Similar image search with specifying target image file 
- [ ] Making binary package of this app which doesn't need python environment building

## Screenshots of Demo
- I used about 1000 image files collected from [freepik](https://freepik.com) which offers free license image materials, as search target example
- Searching and showing results were taken about 5 sec
  - Current all vector matching implementation may need to be faster...
    - Faiss's approximate nearest neighbor (ANN) search feature is promising 
- Search results
  - ![image](https://github.com/user-attachments/assets/364cba3a-71f2-40da-93a6-f756f1d99531)
  - ![image](https://github.com/user-attachments/assets/b58e10ab-6a91-479e-b9b8-7092d3bfb67d)
  - ![image](https://github.com/user-attachments/assets/f2639f36-e639-45e6-b820-5ff1cbcd2fb3)
  - ![image](https://github.com/user-attachments/assets/3b95b3b4-db6d-483f-8bd1-8d2203c16792)
  - ![image](https://github.com/user-attachments/assets/548c1114-2330-4600-82ab-4e29acc39327)
- Image info page
  - ![image](https://github.com/user-attachments/assets/f3c49ed9-d868-4566-9b4f-832dc128ee14)
- Slideshow feature
  - Auto slide in 5 sec period (roop)
  - ![slideshow](https://github.com/user-attachments/assets/0a485613-adb0-4ba0-ac7d-1e124a1a92a8)


